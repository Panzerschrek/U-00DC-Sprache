//##success_test
import "../ustlib/atomic.u"

fn U_Main() : i32
{
	{
		var i32 mut x=-77;
		halt if( ust::atomic_read( x ) != -77 );
		ust::atomic_write( x, 55 );
		halt if( ust::atomic_read( x ) != 55 );
	}
	{
		var u32 mut x=99u;
		halt if( ust::atomic_read( x ) != 99u );
		ust::atomic_write( x, 99999999u );
		halt if( ust::atomic_read( x ) != 99999999u );
	}
	{
		var u32 mut x= 0u;
		halt if( ust::atomic_add( x, 56u ) !=  0u );
		halt if( ust::atomic_sub( x,  6u ) != 56u );
		halt if( ust::atomic_inc( x ) != 50u );
		halt if( ust::atomic_dec( x ) != 51u );
		halt if( x != 50u );
	}
	{
		var i32 mut x= 0;
		halt if( ust::atomic_add( x, 56 ) !=  0 );
		halt if( ust::atomic_sub( x, 66 ) != 56 );
		halt if( ust::atomic_inc( x ) != -10 );
		halt if( ust::atomic_dec( x ) != - 9 );
		halt if( x != -10 );
	}
	{
		var i32 mut x= 0;
		halt if( ust::atomic_compare_and_swap( x, 0, 5 ) != true );
	}
	{
		var i32 mut x= 0;
		halt if( ust::atomic_compare_and_swap( x, 1, 5 ) != false );
	}
	{
		var u32 mut x= 0u;
		halt if( ust::atomic_compare_and_swap( x, 0u, 5u ) != true );
	}
	{
		var u32 mut x= 0u;
		halt if( ust::atomic_compare_and_swap( x, 1u, 5u ) != false );
	}

	return 0;
}

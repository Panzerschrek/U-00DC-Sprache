import "/file_helpers.u"
import "/memory.u"
import "/stdout.u"

fn nomangle main( i32 argc, $($(char8)) argv ) : i32
{
	if( argc < 2 )
	{
		ust::stderr_print( "At least one argument required!\n" );
		return -1;
	}

	var $(char8) arg1_ptr= unsafe( $>( argv + 1s ) );

	var size_type mut len= 0s;
	while( unsafe( $>( arg1_ptr + len ) ) != char8(0) )
	{
		++len;
	}
	auto file_name= unsafe( ust::string_view8( arg1_ptr, len ) );

	auto& contents= "fn Bar() : i32 { return 123321; }";

	if( ust::write_string_view_to_file( file_name, contents ).is_error() )
	{
		ust::stderr_print( "Failed to write file!\n" );
		return -1;
	}

	return 0;
}
